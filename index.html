<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ô‡πâ‡∏≥ ‡∏ó‡∏≠.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        [x-cloak] { display: none !important; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.2s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        .pb-safe { padding-bottom: 6rem; } /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
    </style>

    <script type="module">
        import Alpine from 'https://cdn.jsdelivr.net/npm/alpinejs@3.13.5/dist/module.esm.js';
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, push, set, onValue, remove, update, get } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAXLLitg-7QyX7cA_WNU2iMdSvSsdbBHHk",
            authDomain: "water-queue-system.firebaseapp.com",
            databaseURL: "https://water-queue-system-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "water-queue-system",
            storageBucket: "water-queue-system.firebasestorage.app",
            messagingSenderId: "263603663598",
            appId: "1:263603663598:web:b7cad1f4d116425cf779ff",
            measurementId: "G-LLS33EN3PP"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        Alpine.data('appLogic', () => ({
            systemReady: false,
            currentTab: 'booking',
            
            user: null,
            userRole: 'user', 
            userWing: '',
            authLoading: true,
            authMode: 'login',
            authForm: { email: '', password: '', wing: '' }, 
            authError: '',

            holidays: {}, // ‡∏à‡∏≤‡∏Å Firebase
            autoHolidays: {}, // ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ Auto
            holidaysArray: [],
            userBookings: [], 
            allBookings: [], // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin/Dashboard

            currentStep: 1, 
            form: { type: '', date: '' },
            loading: false,

            calDate: new Date(), 
            calendarDays: [],
            
            // Dashboard Variables
            dashboardDate: new Date(),
            dashboardDays: [],
            selectedDashDate: null,
            selectedDashList: [],

            newHoliday: { date: '', name: '' },

            init() {
                console.log("System initializing...");
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡πÑ‡∏ß‡πâ‡πÄ‡∏•‡∏¢
                this.generateThaiHolidays(new Date().getFullYear());
                this.generateThaiHolidays(new Date().getFullYear() + 1);

                onAuthStateChanged(auth, (user) => {
                    this.user = user;
                    if (user) {
                        this.listenUserData(user);
                        this.loadHolidays();
                        this.loadBookings();
                    } else {
                        this.resetUserState();
                    }
                    this.authLoading = false;
                    this.systemReady = true;
                });
            },

            // --- AUTO HOLIDAYS SYSTEM ---
            generateThaiHolidays(year) {
                // ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
                const fixed = {
                    '01-01': '‡∏ß‡∏±‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà',
                    '04-06': '‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏Å‡∏£‡∏µ',
                    '04-13': '‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå',
                    '04-14': '‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå',
                    '04-15': '‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå',
                    '05-04': '‡∏ß‡∏±‡∏ô‡∏â‡∏±‡∏ï‡∏£‡∏°‡∏á‡∏Ñ‡∏•',
                    '06-03': '‡∏ß‡∏±‡∏ô‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏Ø ‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏¥‡∏ô‡∏µ',
                    '07-28': '‡∏ß‡∏±‡∏ô‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏Ø ‡∏£.10',
                    '08-12': '‡∏ß‡∏±‡∏ô‡πÅ‡∏°‡πà‡πÅ‡∏´‡πà‡∏á‡∏ä‡∏≤‡∏ï‡∏¥',
                    '10-13': '‡∏ß‡∏±‡∏ô‡∏ô‡∏ß‡∏°‡∏¥‡∏ô‡∏ó‡∏£‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä',
                    '10-23': '‡∏ß‡∏±‡∏ô‡∏õ‡∏¥‡∏¢‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä',
                    '12-05': '‡∏ß‡∏±‡∏ô‡∏û‡πà‡∏≠‡πÅ‡∏´‡πà‡∏á‡∏ä‡∏≤‡∏ï‡∏¥',
                    '12-10': '‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç',
                    '12-31': '‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏õ‡∏µ'
                };
                
                // ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ï‡∏≤‡∏°‡∏à‡∏±‡∏ô‡∏ó‡∏£‡∏Ñ‡∏ï‡∏¥ (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏õ‡∏µ 2025-2026)
                // *‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Library ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏î‡∏¥‡∏ñ‡∏µ ‡πÅ‡∏ï‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢‡∏à‡∏∞ Hardcode ‡∏õ‡∏µ‡∏´‡∏•‡∏±‡∏Å‡πÜ*
                const lunar = {
                    2025: {
                        '02-12': '‡∏ß‡∏±‡∏ô‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤',
                        '05-11': '‡∏ß‡∏±‡∏ô‡∏ß‡∏¥‡∏™‡∏≤‡∏Ç‡∏ö‡∏π‡∏ä‡∏≤',
                        '07-10': '‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏™‡∏≤‡∏¨‡∏´‡∏ö‡∏π‡∏ä‡∏≤',
                        '07-11': '‡∏ß‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏£‡∏£‡∏©‡∏≤'
                    },
                    2026: {
                        '03-03': '‡∏ß‡∏±‡∏ô‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤',
                        '05-31': '‡∏ß‡∏±‡∏ô‡∏ß‡∏¥‡∏™‡∏≤‡∏Ç‡∏ö‡∏π‡∏ä‡∏≤',
                        '07-29': '‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏™‡∏≤‡∏¨‡∏´‡∏ö‡∏π‡∏ä‡∏≤',
                        '07-30': '‡∏ß‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏£‡∏£‡∏©‡∏≤'
                    }
                };

                // Merge Fixed
                for (const [day, name] of Object.entries(fixed)) {
                    this.autoHolidays[`${year}-${day}`] = name;
                }
                // Merge Lunar
                if (lunar[year]) {
                    for (const [day, name] of Object.entries(lunar[year])) {
                        this.autoHolidays[`${year}-${day}`] = name;
                    }
                }
                
                // ** ‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô (05-01) ‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏° ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏´‡∏¢‡∏∏‡∏î **
            },

            listenUserData(user) {
                const userRef = ref(db, 'users/' + user.uid);
                onValue(userRef, (snapshot) => {
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        this.userRole = (data.role || 'user').toLowerCase(); 
                        this.userWing = data.wing || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô'; 
                    } else {
                        this.userRole = 'user';
                        this.userWing = '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                    }
                });
            },

            resetUserState() {
                this.userRole = 'user';
                this.userWing = '';
                this.currentStep = 1;
                this.userBookings = [];
            },

            loadHolidays() {
                const holidaysRef = ref(db, 'holidays');
                onValue(holidaysRef, (snapshot) => {
                    const data = snapshot.val() || {};
                    this.holidays = data;
                    // ‡∏£‡∏ß‡∏° Manual + Auto Holidays
                    this.holidaysArray = [
                        ...Object.keys(data).map(k => ({ date: k, name: data[k], type: 'manual' })),
                        ...Object.keys(this.autoHolidays).map(k => ({ date: k, name: this.autoHolidays[k], type: 'auto' }))
                    ].sort((a, b) => a.date.localeCompare(b.date));

                    if(this.currentStep === 2) this.generateCalendar();
                    if(this.currentTab === 'dashboard') this.generateDashboardCalendar();
                });
            },

            loadBookings() {
                const bookingsRef = ref(db, 'bookings');
                onValue(bookingsRef, (snapshot) => {
                    const data = snapshot.val() || {};
                    const all = Object.keys(data).map(key => ({ id: key, ...data[key] }));
                    
                    // ‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Dashboard
                    this.allBookings = all;

                    // Filter ‡∏Ç‡∏≠‡∏á User ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ History
                    this.userBookings = all
                        .filter(item => item.userId === this.user.uid || this.userRole === 'admin' || this.userRole === 'staff')
                        .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    
                    if(this.currentTab === 'dashboard') this.generateDashboardCalendar();
                });
            },

            toggleAuthMode() { this.authMode = this.authMode === 'login' ? 'register' : 'login'; this.authError = ''; },
            async handleAuth() {
                this.authError = '';
                if (!this.authForm.email || !this.authForm.password) { this.authError = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'; return; }
                if (this.authMode === 'register' && !this.authForm.wing) { this.authError = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô'; return; }

                this.loading = true;
                try {
                    if (this.authMode === 'register') {
                        const cred = await createUserWithEmailAndPassword(auth, this.authForm.email, this.authForm.password);
                        await set(ref(db, 'users/' + cred.user.uid), {
                            email: this.authForm.email,
                            wing: this.authForm.wing,
                            role: 'user',
                            createdAt: new Date().toISOString()
                        });
                    } else {
                        await signInWithEmailAndPassword(auth, this.authForm.email, this.authForm.password);
                    }
                    this.authForm = { email: '', password: '', wing: '' };
                } catch (error) {
                    this.authError = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.code;
                } finally {
                    this.loading = false;
                }
            },
            handleLogout() { signOut(auth); },

            // --- STAFF HOLIDAY ---
            addHoliday() {
                if(!this.newHoliday.date || !this.newHoliday.name) return;
                set(ref(db, 'holidays/' + this.newHoliday.date), this.newHoliday.name);
                this.newHoliday = { date: '', name: '' };
            },
            deleteHoliday(dateKey) {
                if(confirm('‡∏•‡∏ö?')) remove(ref(db, 'holidays/' + dateKey));
            },

            // --- DASHBOARD LOGIC (NEW) ---
            changeDashMonth(offset) {
                this.dashboardDate = new Date(this.dashboardDate.getFullYear(), this.dashboardDate.getMonth() + offset, 1);
                this.generateDashboardCalendar();
            },
            generateDashboardCalendar() {
                const year = this.dashboardDate.getFullYear();
                const month = this.dashboardDate.getMonth();
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                let days = [];
                for (let i = 0; i < firstDay; i++) days.push({ blank: true });

                for (let i = 1; i <= daysInMonth; i++) {
                    const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
                    
                    // ‡∏´‡∏≤ Bookings ‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                    const dailyBookings = this.allBookings.filter(b => b.date === dateStr);
                    const holidayName = this.holidays[dateStr] || this.autoHolidays[dateStr];

                    days.push({
                        day: i,
                        fullDate: dateStr,
                        count: dailyBookings.length,
                        hasGood: dailyBookings.some(b => b.type === 'good'),
                        hasWaste: dailyBookings.some(b => b.type === 'waste'),
                        isHoliday: !!holidayName,
                        holidayName: holidayName,
                        selected: this.selectedDashDate === dateStr
                    });
                }
                this.dashboardDays = days;
            },
            selectDashDate(dayObj) {
                if(dayObj.blank) return;
                this.selectedDashDate = dayObj.fullDate;
                this.selectedDashList = this.allBookings.filter(b => b.date === dayObj.fullDate);
                this.generateDashboardCalendar(); // Refresh highlight
            },

            // --- BOOKING LOGIC ---
            selectType(typeName) { 
                this.form.type = typeName; 
                this.generateCalendar(); 
                this.nextStep(); 
            },
            nextStep() { if(this.currentStep < 2) this.currentStep++; },
            prevStep() { if(this.currentStep > 1) this.currentStep--; },

            changeMonth(offset) {
                this.calDate = new Date(this.calDate.getFullYear(), this.calDate.getMonth() + offset, 1);
                this.generateCalendar();
            },
            
            generateCalendar() {
                const year = this.calDate.getFullYear();
                const month = this.calDate.getMonth();
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                let days = [];
                for (let i = 0; i < firstDay; i++) days.push({ blank: true });

                const today = new Date();
                today.setHours(0,0,0,0);

                for (let i = 1; i <= daysInMonth; i++) {
                    const dateObj = new Date(year, month, i);
                    const dateStr = dateObj.toISOString().split('T')[0];
                    
                    let status = 'available'; 
                    let reason = '';

                    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î (‡∏ó‡∏±‡πâ‡∏á Manual ‡πÅ‡∏•‡∏∞ Auto)
                    const isManualHoliday = this.holidays[dateStr];
                    const isAutoHoliday = this.autoHolidays[dateStr];

                    if (dateObj < today) {
                        status = 'unavailable'; reason = '‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß';
                    }
                    else if (isManualHoliday || isAutoHoliday) {
                        status = 'unavailable'; reason = isManualHoliday || isAutoHoliday;
                    }
                    else if (dateObj.getDay() === 0 || dateObj.getDay() === 6) {
                        status = 'unavailable'; reason = '‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î ‡∏™-‡∏≠';
                    }
                    else if (this.form.type === 'good') {
                        if (dateObj.getDay() > 3) { status = 'unavailable'; reason = '‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡∏à-‡∏û'; }
                    }
                    else if (this.form.type === 'waste') {
                        // ‡∏û‡∏∏‡∏ò(3), ‡∏û‡∏§‡∏´‡∏±‡∏™(4)
                        if (dateObj.getDay() !== 3 && dateObj.getDay() !== 4) { 
                            status = 'unavailable'; reason = '‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡∏û‡∏∏‡∏ò-‡∏û‡∏§'; 
                        } else {
                            // BOD5 Check
                            const next5 = new Date(dateObj);
                            next5.setDate(dateObj.getDate() + 5);
                            const next5Str = next5.toISOString().split('T')[0];
                            
                            if (next5.getDay() === 0 || next5.getDay() === 6) {
                                status = 'unavailable'; reason = '‡∏ß‡∏±‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏ú‡∏•‡∏ï‡∏¥‡∏î ‡∏™-‡∏≠';
                            }
                            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (Manual + Auto)
                            if (this.holidays[next5Str] || this.autoHolidays[next5Str]) {
                                status = 'unavailable'; reason = `‡∏ß‡∏±‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏ú‡∏•‡∏ï‡∏¥‡∏î‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î (${this.holidays[next5Str] || this.autoHolidays[next5Str]})`;
                            }
                        }
                    }

                    days.push({
                        day: i,
                        fullDate: dateStr,
                        status: status,
                        reason: reason,
                        selected: this.form.date === dateStr
                    });
                }
                this.calendarDays = days;
            },

            selectDate(dayObj) {
                if (dayObj.status === 'unavailable' || dayObj.blank) return;
                this.form.date = dayObj.fullDate;
                this.generateCalendar();
            },

            submit() {
                if (!this.form.date) return;
                this.loading = true;
                const newBookingRef = push(ref(db, 'bookings'));
                set(newBookingRef, {
                    ...this.form,
                    wing: this.userWing,
                    userId: this.user.uid,
                    userEmail: this.user.email,
                    timestamp: new Date().toISOString(),
                    status: '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö'
                }).then(() => {
                    alert('üéâ ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏ô‡∏π "‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•"');
                    this.currentStep = 1; 
                    this.form = { type: '', date: '' };
                    this.currentTab = 'history';
                    this.loading = false;
                });
            },

            formatDate(dateStr) {
                if(!dateStr) return '-';
                const d = new Date(dateStr);
                return d.toLocaleDateString('th-TH', { year: 'numeric', month: 'short', day: 'numeric' });
            },
            getMonthName(date) {
                return date.toLocaleDateString('th-TH', { month: 'long', year: 'numeric' });
            },
            getStatusColor(status) {
                if(status === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö') return 'bg-yellow-100 text-yellow-800';
                if(status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á') return 'bg-green-100 text-green-800';
                if(status === '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò') return 'bg-red-100 text-red-800';
                if(status === '‡∏ú‡∏•‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß') return 'bg-blue-100 text-blue-800 font-bold';
                return 'bg-gray-100 text-gray-800';
            }
        }));
        Alpine.start();
    </script>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden" x-data="appLogic()" x-cloak>

    <div x-show="!systemReady" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-700"></div>
    </div>

    <header class="bg-gradient-to-r from-blue-800 to-indigo-900 text-white p-4 pt-8 shadow-lg z-20 rounded-b-[2rem] shrink-0">
        <div class="flex justify-between items-start max-w-md mx-auto">
            <div>
                <h1 class="text-lg font-bold leading-tight">‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ô‡πâ‡∏≥ ‡∏ó‡∏≠.</h1>
                <p class="text-xs text-blue-200 opacity-90 mt-1">‡∏Å‡∏£‡∏°‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ó‡∏´‡∏≤‡∏£‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</p>
            </div>
            
            <template x-if="user">
                <div class="flex flex-col items-end text-right">
                    <div class="text-sm font-bold text-yellow-300" x-text="userWing"></div>
                    <div class="flex items-center space-x-2 mt-0.5">
                        <span class="text-[10px] bg-white/20 px-2 py-0.5 rounded-full" x-text="userRole === 'admin' ? 'Admin' : (userRole === 'staff' ? '‡∏à‡∏ô‡∏ó.' : 'User')"></span>
                        <span class="text-xs text-blue-100" x-text="user.email.split('@')[0]"></span>
                    </div>
                </div>
            </template>
        </div>
    </header>

    <main class="flex-1 relative max-w-md mx-auto w-full p-4 overflow-y-auto no-scrollbar pb-safe">
        
        <!-- LOGIN -->
        <div x-show="!user && systemReady" class="flex flex-col items-center justify-center h-full space-y-6">
            <div class="text-center">
                <h2 class="text-xl font-bold text-slate-800">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
                <p class="text-sm text-slate-500">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à</p>
            </div>
            <div class="w-full bg-white p-6 rounded-2xl shadow-sm border space-y-4">
                <div x-show="authMode === 'register'">
                    <label class="text-xs font-bold text-slate-500 ml-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                    <input type="text" x-model="authForm.wing" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô" class="w-full p-3 rounded-xl border bg-slate-50 mt-1">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 ml-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                    <input type="email" x-model="authForm.email" placeholder="Email" class="w-full p-3 rounded-xl border bg-slate-50 mt-1">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 ml-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" x-model="authForm.password" placeholder="Password" class="w-full p-3 rounded-xl border bg-slate-50 mt-1">
                </div>
                <p x-show="authError" x-text="authError" class="text-red-500 text-xs text-center"></p>
                <button @click="handleAuth()" :disabled="loading" class="w-full py-3 rounded-xl text-white font-bold bg-blue-600 shadow-md">
                    <span x-show="!loading" x-text="authMode === 'login' ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö' : '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô'"></span>
                    <span x-show="loading">...</span>
                </button>
            </div>
            <button @click="toggleAuthMode()" class="text-sm text-blue-600 underline" x-text="authMode === 'login' ? '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà' : '‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'"></button>
        </div>

        <!-- 1. BOOKING TAB -->
        <template x-if="user && currentTab === 'booking'">
            <div class="h-full flex flex-col">
                <div x-show="currentStep === 1" class="space-y-4 animate-fade-in">
                    <h2 class="text-xl font-bold text-center text-slate-700 mb-2">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</h2>
                    
                    <button @click="selectType('good')" class="w-full p-6 rounded-2xl border-2 hover:border-blue-500 bg-white shadow-sm flex items-center justify-between transition-all hover:bg-blue-50">
                        <div class="text-left">
                            <div class="text-lg font-bold text-blue-700">‡∏ô‡πâ‡∏≥‡∏î‡∏µ (‡∏õ‡∏£‡∏∞‡∏õ‡∏≤)</div>
                            <div class="text-xs text-gray-500">‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå - ‡∏û‡∏∏‡∏ò</div>
                        </div>
                        <div class="text-3xl">üíß</div>
                    </button>
                    
                    <button @click="selectType('waste')" class="w-full p-6 rounded-2xl border-2 hover:border-red-500 bg-white shadow-sm flex items-center justify-between transition-all hover:bg-red-50">
                        <div class="text-left">
                            <div class="text-lg font-bold text-red-700">‡∏ô‡πâ‡∏≥‡πÄ‡∏™‡∏µ‡∏¢</div>
                            <div class="text-xs text-gray-500">‡∏û‡∏∏‡∏ò - ‡∏û‡∏§‡∏´‡∏±‡∏™ (‡∏ö‡πà‡∏° 5 ‡∏ß‡∏±‡∏ô)</div>
                        </div>
                        <div class="text-3xl">üß™</div>
                    </button>
                </div>

                <div x-show="currentStep === 2" class="space-y-4 animate-fade-in">
                    <div class="flex items-center justify-between">
                        <button @click="prevStep()" class="text-sm text-gray-500 flex items-center"><svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg> ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
                        <h3 class="font-bold text-slate-700" x-text="form.type==='good'?'‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ô‡πâ‡∏≥‡∏î‡∏µ':'‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ô‡πâ‡∏≥‡πÄ‡∏™‡∏µ‡∏¢'"></h3>
                    </div>

                    <div class="bg-white rounded-2xl shadow-sm border p-4">
                        <div class="flex justify-between items-center mb-4">
                            <button @click="changeMonth(-1)" class="p-2 hover:bg-gray-100 rounded-full text-gray-600"><</button>
                            <div class="font-bold text-lg text-slate-800" x-text="getMonthName(calDate)"></div>
                            <button @click="changeMonth(1)" class="p-2 hover:bg-gray-100 rounded-full text-gray-600">></button>
                        </div>
                        
                        <div class="grid grid-cols-7 mb-2 text-center">
                            <div class="text-xs text-red-500 font-bold">‡∏≠‡∏≤</div>
                            <div class="text-xs text-gray-500">‡∏à</div>
                            <div class="text-xs text-gray-500">‡∏≠</div>
                            <div class="text-xs text-gray-500">‡∏û</div>
                            <div class="text-xs text-gray-500">‡∏û‡∏§</div>
                            <div class="text-xs text-gray-500">‡∏®</div>
                            <div class="text-xs text-red-500 font-bold">‡∏™</div>
                        </div>

                        <div class="grid grid-cols-7 gap-1">
                            <template x-for="d in calendarDays">
                                <div>
                                    <template x-if="d.blank">
                                        <div class="h-10"></div>
                                    </template>
                                    <template x-if="!d.blank">
                                        <button @click="selectDate(d)" 
                                            class="w-full h-12 rounded-lg flex flex-col items-center justify-center text-xs relative transition-all border border-transparent"
                                            :class="{
                                                'bg-gray-50 text-gray-300 cursor-not-allowed': d.status === 'unavailable',
                                                'bg-green-50 text-green-700 hover:bg-green-100 hover:border-green-300 font-bold': d.status === 'available' && !d.selected,
                                                'bg-blue-600 text-white shadow-md transform scale-105 z-10': d.selected
                                            }">
                                            <span x-text="d.day" class="text-sm"></span>
                                            <span x-show="d.status==='unavailable'" class="text-[8px] leading-tight px-1 truncate w-full" x-text="d.reason"></span>
                                            <span x-show="d.status==='available' && !d.selected" class="text-[8px] text-green-600">‡∏ß‡πà‡∏≤‡∏á</span>
                                            <span x-show="d.selected" class="text-[8px] text-white">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
                                        </button>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </div>

                    <div x-show="form.date" class="bg-blue-50 p-4 rounded-xl border border-blue-100 text-center">
                        <div class="text-sm text-blue-800 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>
                        <div class="text-xl font-bold text-blue-900" x-text="formatDate(form.date)"></div>
                        <button @click="submit()" :disabled="loading" class="w-full mt-3 py-3 bg-blue-600 text-white rounded-xl font-bold shadow-lg">
                            <span x-show="!loading">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</span>
                            <span x-show="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...</span>
                        </button>
                    </div>
                </div>
            </div>
        </template>

        <!-- 2. HISTORY TAB -->
        <template x-if="user && currentTab === 'history'">
            <div class="h-full flex flex-col space-y-4">
                <h2 class="text-xl font-bold text-center text-slate-700">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à</h2>
                
                <div class="flex-1 overflow-y-auto space-y-3">
                    <template x-for="book in userBookings" :key="book.id">
                        <div class="bg-white p-4 rounded-xl border shadow-sm relative overflow-hidden">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <div class="text-xs text-gray-500">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</div>
                                    <div class="font-bold text-slate-800" x-text="formatDate(book.date)"></div>
                                </div>
                                <span class="text-[10px] px-2 py-1 rounded-full border" 
                                      :class="getStatusColor(book.status)" 
                                      x-text="book.status"></span>
                            </div>
                            <div class="flex items-center text-xs text-gray-500 space-x-2">
                                <span x-text="book.type==='good'?'üíß ‡∏ô‡πâ‡∏≥‡∏î‡∏µ':'üß™ ‡∏ô‡πâ‡∏≥‡πÄ‡∏™‡∏µ‡∏¢'"></span>
                                <span>‚Ä¢</span>
                                <span x-text="book.wing"></span>
                            </div>
                            <template x-if="book.resultLink">
                                <a :href="book.resultLink" target="_blank" class="mt-3 block text-center w-full py-2 bg-blue-50 text-blue-700 text-xs font-bold rounded-lg hover:bg-blue-100">
                                    üìÑ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•
                                </a>
                            </template>
                        </div>
                    </template>
                    
                    <div x-show="userBookings.length === 0" class="text-center py-10 text-gray-400">
                        <div class="text-4xl mb-2">üì≠</div>
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                    </div>
                </div>
            </div>
        </template>

        <!-- 3. DASHBOARD TAB (NEW for Admin/Staff) -->
        <template x-if="user && currentTab === 'dashboard'">
            <div class="h-full flex flex-col space-y-3">
                <h2 class="text-xl font-bold text-center text-slate-700">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á (Dashboard)</h2>
                
                <!-- Dashboard Calendar -->
                <div class="bg-white rounded-2xl shadow-sm border p-4">
                    <div class="flex justify-between items-center mb-4">
                        <button @click="changeDashMonth(-1)" class="p-2 hover:bg-gray-100 rounded-full"><</button>
                        <div class="font-bold text-lg text-slate-800" x-text="getMonthName(dashboardDate)"></div>
                        <button @click="changeDashMonth(1)" class="p-2 hover:bg-gray-100 rounded-full">></button>
                    </div>
                    
                    <div class="grid grid-cols-7 mb-2 text-center text-xs text-gray-500">
                        <div>‡∏≠‡∏≤</div><div>‡∏à</div><div>‡∏≠</div><div>‡∏û</div><div>‡∏û‡∏§</div><div>‡∏®</div><div>‡∏™</div>
                    </div>

                    <div class="grid grid-cols-7 gap-1">
                        <template x-for="d in dashboardDays">
                            <div>
                                <template x-if="d.blank"><div class="h-10"></div></template>
                                <template x-if="!d.blank">
                                    <button @click="selectDashDate(d)" 
                                        class="w-full h-12 rounded-lg flex flex-col items-center justify-start pt-1 text-xs relative transition-all border"
                                        :class="d.selected ? 'border-blue-500 bg-blue-50 ring-1 ring-blue-500' : 'border-slate-100 hover:bg-slate-50'">
                                        <span x-text="d.day" :class="d.isHoliday?'text-red-500 font-bold':''"></span>
                                        
                                        <!-- Dots Indicator -->
                                        <div class="flex space-x-0.5 mt-1">
                                            <template x-if="d.hasGood"><div class="w-1.5 h-1.5 rounded-full bg-blue-400"></div></template>
                                            <template x-if="d.hasWaste"><div class="w-1.5 h-1.5 rounded-full bg-red-400"></div></template>
                                        </div>
                                        <div x-show="d.count > 0" class="text-[8px] text-gray-400 mt-auto mb-1" x-text="d.count"></div>
                                    </button>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Detail List (Popup style) -->
                <div x-show="selectedDashDate" class="flex-1 bg-slate-50 rounded-t-2xl p-4 border shadow-inner overflow-y-auto animate-fade-in">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-bold text-slate-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: <span x-text="formatDate(selectedDashDate)"></span></h3>
                        <button @click="selectedDashDate = null" class="text-xs text-gray-500">‡∏õ‡∏¥‡∏î</button>
                    </div>

                    <div class="space-y-2">
                        <template x-for="item in selectedDashList">
                            <div class="bg-white p-3 rounded-lg border flex justify-between items-center">
                                <div>
                                    <div class="font-bold text-sm text-slate-700" x-text="item.wing"></div>
                                    <div class="text-xs text-gray-500" x-text="item.type==='good'?'‡∏ô‡πâ‡∏≥‡∏î‡∏µ':'‡∏ô‡πâ‡∏≥‡πÄ‡∏™‡∏µ‡∏¢'"></div>
                                </div>
                                <span class="text-[10px] px-2 py-1 rounded bg-slate-100" x-text="item.status"></span>
                            </div>
                        </template>
                        <div x-show="selectedDashList.length === 0" class="text-center text-gray-400 text-sm py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                    </div>
                </div>
            </div>
        </template>

        <!-- 4. STAFF SETTING TAB -->
        <template x-if="user && currentTab === 'staff_panel'">
            <div class="space-y-4">
                <h2 class="text-xl font-bold text-center text-slate-700">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</h2>
                
                <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200">
                    <h3 class="font-bold text-yellow-800 mb-2 text-sm">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏© / ‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏ï‡∏£‡∏ß‡∏à</h3>
                    <div class="flex space-x-2">
                        <input type="date" x-model="newHoliday.date" class="p-2 rounded border w-1/3 text-sm">
                        <input type="text" x-model="newHoliday.name" placeholder="‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏" class="p-2 rounded border flex-1 text-sm">
                        <button @click="addHoliday()" class="bg-yellow-600 text-white px-3 rounded font-bold hover:bg-yellow-700 text-sm">+</button>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                    <div class="bg-slate-100 p-2 text-xs font-bold text-slate-600 px-4 flex justify-between">
                        <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</span>
                        <span class="text-gray-400 font-normal">*‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß</span>
                    </div>
                    <div class="divide-y max-h-64 overflow-y-auto">
                        <template x-for="h in holidaysArray">
                            <div class="p-3 flex justify-between items-center text-sm hover:bg-slate-50">
                                <div>
                                    <div class="font-bold text-slate-800 flex items-center">
                                        <span x-text="formatDate(h.date)"></span>
                                        <span x-show="h.type==='auto'" class="ml-2 text-[8px] bg-gray-200 px-1 rounded text-gray-500">Auto</span>
                                    </div>
                                    <div class="text-xs text-slate-500" x-text="h.name"></div>
                                </div>
                                <button x-show="h.type === 'manual'" @click="deleteHoliday(h.date)" class="text-red-500 hover:underline">‡∏•‡∏ö</button>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </template>
    </main>

    <!-- TAB BAR -->
    <nav x-show="user" class="bg-white border-t border-slate-200 fixed bottom-0 w-full max-w-md left-0 right-0 mx-auto pb-safe shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-50 h-16">
        <div class="flex justify-around items-center h-full">
            <!-- 1. Booking -->
            <button @click="currentTab = 'booking'" class="flex flex-col items-center justify-center w-14 space-y-1"
                :class="currentTab === 'booking' ? 'text-blue-600' : 'text-gray-400'">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span class="text-[9px] font-bold">‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</span>
            </button>
            
            <!-- 2. History -->
            <button @click="currentTab = 'history'" class="flex flex-col items-center justify-center w-14 space-y-1"
                :class="currentTab === 'history' ? 'text-blue-600' : 'text-gray-400'">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                </svg>
                <span class="text-[9px] font-bold">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</span>
            </button>

            <!-- 3. Dashboard (Admin Only) -->
            <template x-if="userRole === 'admin' || userRole === 'staff'">
                <button @click="currentTab = 'dashboard'" class="flex flex-col items-center justify-center w-14 space-y-1"
                    :class="currentTab === 'dashboard' ? 'text-blue-600' : 'text-gray-400'">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                    </svg>
                    <span class="text-[9px] font-bold">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</span>
                </button>
            </template>

            <!-- 4. Manage Holiday (Admin Only) -->
            <template x-if="userRole === 'admin' || userRole === 'staff'">
                <button @click="currentTab = 'staff_panel'" class="flex flex-col items-center justify-center w-14 space-y-1"
                    :class="currentTab === 'staff_panel' ? 'text-yellow-600' : 'text-gray-400'">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                    </svg>
                    <span class="text-[9px] font-bold">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
                </button>
            </template>

            <!-- Logout -->
            <button @click="handleLogout()" class="flex flex-col items-center justify-center w-14 space-y-1 text-red-400 hover:text-red-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
                <span class="text-[9px] font-bold">‡∏≠‡∏≠‡∏Å</span>
            </button>
        </div>
    </nav>

</body>
</html>
